<!DOCTYPE html>
<html>
  <head>
    <title>
      go.fish
    </title>
    <link href="./fish.css" rel="stylesheet">
    </link>
  </head>
  <body>
    <div class="fullscreen">
      <h1>
        go.fish
      </h1>
    </div>
    <div class="fish fish1">
      <img \="" src="./red.svg">
      </img>
    </div>
    <div class="fish fish2">
      <img \="" src="./orange.svg">
      </img>
    </div>
    <div class="fish fish3">
      <img \="" src="./yellow.svg">
      </img>
    </div>
    <script>
      function plusOrMinus() {
        return Math.random() < 0.5 ? -1 : 1;
      }
      function getRandomTargetDeltaX() {
        const randX = plusOrMinus() * Math.random() * 120;
        return randX < 0 && randX > -80 ? getRandomTargetDeltaX() : randX;
      }
      function getRandomTargetDeltaY() {
        const randY = plusOrMinus() * Math.random() * 120;
        return randY < 0 && randY > -50 ? getRandomTargetDeltaY() : randY;
      }
      function buildFishObject(fishNode) {
        fishNode.style.zIndex = Math.floor(Math.random() * 4);
        return {
          el: fishNode,
          x: 0,
          y: 0,
          speed: Math.floor(Math.random() * 6) + 4,
          targetDelta: {
            x: getRandomTargetDeltaX(), 
            y: getRandomTargetDeltaY(),
          },
        }
      }

      const fishes = [...document.querySelectorAll(".fish")].map(buildFishObject);

      let mouseX = 0;
      let mouseY = 0;
      let timeOfLastMove = Date.now()
      window.addEventListener("mousemove", function(event) {
        mouseX = event.clientX;
        mouseY = event.clientY;
        timeOfLastMove = Date.now();
      });

      let animationTime = Date.now();
      function moveFish() {

        // Calculate the amount of time that has passed since the last animation frame.
        const now = Date.now()
        let elapsedTime = now - animationTime;
        animationTime = now;

        for (const fish of fishes) {
          // Set fish position.
          const deltaX = mouseX + fish.targetDelta.x - fish.x;
          const deltaY = mouseY + fish.targetDelta.y - fish.y;

          fish.x += deltaX * elapsedTime * fish.speed / 3000;
          fish.y += deltaY * elapsedTime * fish.speed / 3000;
          fish.el.style.setProperty('--fishX', fish.x + 'px');
          fish.el.style.setProperty('--fishY', fish.y + 'px');
          

          // Set fish angle.
          const rect = fish.el.getBoundingClientRect();

          const p2 = {x: mouseX, y: mouseY};
          const p1 = {x: (rect.left + rect.width / 2) + window.scrollX, y: (rect.top + rect.height / 2) + window.scrollY};  

          const angleDeg = ((Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI) + 180) % 360;
          fish.el.style.setProperty('--fishAngle', angleDeg + 'deg');
        }

        requestAnimationFrame(moveFish);
      }
      requestAnimationFrame(moveFish);
    </script>
  </body>
</html>
